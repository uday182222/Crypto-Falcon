<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Dashboard Debug Page</h1>
    
    <div class="test-section info">
        <h3>üîß System Status</h3>
        <div id="system-status">Checking...</div>
    </div>
    
    <div class="test-section">
        <h3>üîê Authentication Test</h3>
        <button onclick="testAuth()" class="btn-primary">Test Authentication</button>
        <button onclick="testLogin()" class="btn-success">Test Login</button>
        <button onclick="clearAuth()" class="btn-danger">Clear Auth</button>
        <div id="auth-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üåê API Connection Test</h3>
        <button onclick="testAPI()" class="btn-primary">Test API Connection</button>
        <div id="api-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üìä Dashboard Data Test</h3>
        <button onclick="testDashboardData()" class="btn-primary">Test Dashboard Data</button>
        <div id="dashboard-result"></div>
    </div>
    
    <div class="test-section">
        <h3>üöÄ Quick Actions</h3>
        <button onclick="goToLogin()" class="btn-primary">Go to Login</button>
        <button onclick="goToDashboard()" class="btn-success">Go to Dashboard</button>
        <button onclick="autoLogin()" class="btn-success">Auto Login (Demo)</button>
    </div>

    <script src="./js/api.js"></script>
    <script>
        // System status check
        function updateSystemStatus() {
            const status = document.getElementById('system-status');
            const isAuth = MotionFalconUI.isAuthenticated();
            const token = localStorage.getItem('motionfalcon_token');
            
            status.innerHTML = `
                <p><strong>Backend URL:</strong> ${API_BASE_URL}</p>
                <p><strong>Authentication:</strong> ${isAuth ? '‚úÖ Authenticated' : '‚ùå Not Authenticated'}</p>
                <p><strong>Token:</strong> ${token ? '‚úÖ Present' : '‚ùå Missing'}</p>
                <p><strong>Current Page:</strong> ${window.location.pathname}</p>
            `;
        }
        
        // Test authentication
        async function testAuth() {
            const result = document.getElementById('auth-result');
            result.innerHTML = '<p>Testing authentication...</p>';
            
            try {
                const isAuth = MotionFalconUI.isAuthenticated();
                const token = localStorage.getItem('motionfalcon_token');
                
                result.innerHTML = `
                    <div class="success">
                        <h4>Authentication Status:</h4>
                        <p><strong>Is Authenticated:</strong> ${isAuth}</p>
                        <p><strong>Token Present:</strong> ${!!token}</p>
                        <p><strong>Token Value:</strong> ${token ? token.substring(0, 20) + '...' : 'None'}</p>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h4>Authentication Error:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Test login
        async function testLogin() {
            const result = document.getElementById('auth-result');
            result.innerHTML = '<p>Testing login...</p>';
            
            try {
                const response = await api.login('integration@test.com', 'testpass123');
                result.innerHTML = `
                    <div class="success">
                        <h4>Login Successful:</h4>
                        <pre>${JSON.stringify(response, null, 2)}</pre>
                    </div>
                `;
                updateSystemStatus();
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h4>Login Error:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Clear authentication
        function clearAuth() {
            api.clearToken();
            localStorage.removeItem('motionfalcon_user');
            const result = document.getElementById('auth-result');
            result.innerHTML = `
                <div class="info">
                    <h4>Authentication Cleared:</h4>
                    <p>All authentication data has been removed.</p>
                </div>
            `;
            updateSystemStatus();
        }
        
        // Test API connection
        async function testAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<p>Testing API connection...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                const data = await response.json();
                
                result.innerHTML = `
                    <div class="success">
                        <h4>API Connection Successful:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h4>API Connection Error:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Test dashboard data
        async function testDashboardData() {
            const result = document.getElementById('dashboard-result');
            result.innerHTML = '<p>Testing dashboard data...</p>';
            
            try {
                const tests = [];
                
                // Test profile
                try {
                    const profile = await api.getProfile();
                    tests.push({ name: 'Profile', status: 'success', data: profile });
                } catch (error) {
                    tests.push({ name: 'Profile', status: 'error', error: error.message });
                }
                
                // Test portfolio
                try {
                    const portfolio = await api.getPortfolio();
                    tests.push({ name: 'Portfolio', status: 'success', data: portfolio });
                } catch (error) {
                    tests.push({ name: 'Portfolio', status: 'error', error: error.message });
                }
                
                // Test prices
                try {
                    const prices = await api.getPrices();
                    tests.push({ name: 'Prices', status: 'success', data: prices });
                } catch (error) {
                    tests.push({ name: 'Prices', status: 'error', error: error.message });
                }
                
                // Display results
                let html = '<h4>Dashboard Data Test Results:</h4>';
                tests.forEach(test => {
                    if (test.status === 'success') {
                        html += `
                            <div class="success">
                                <h5>‚úÖ ${test.name}</h5>
                                <pre>${JSON.stringify(test.data, null, 2)}</pre>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="error">
                                <h5>‚ùå ${test.name}</h5>
                                <p>${test.error}</p>
                            </div>
                        `;
                    }
                });
                
                result.innerHTML = html;
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h4>Dashboard Data Error:</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Quick actions
        function goToLogin() {
            window.location.href = 'page-login.html';
        }
        
        function goToDashboard() {
            window.location.href = 'index.html';
        }
        
        async function autoLogin() {
            try {
                await api.login('integration@test.com', 'testpass123');
                window.location.href = 'index.html';
            } catch (error) {
                alert('Auto login failed: ' + error.message);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateSystemStatus();
        });
    </script>
</body>
</html> 