<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Backend Connection Test - MotionFalcon</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .status-success { color: #28a745; }
        .status-error { color: #dc3545; }
        .status-warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="test-card p-4">
                    <h1 class="text-center mb-4">üîß Backend Connection Test</h1>
                    <p class="text-center text-muted mb-4">Testing MotionFalcon Backend API Integration</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5>üîê Authentication Tests</h5>
                            <div id="auth-tests">
                                <div class="mb-3">
                                    <button class="btn btn-primary btn-sm" onclick="testHealthCheck()">Health Check</button>
                                    <span id="health-status" class="ms-2">‚è≥</span>
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-success btn-sm" onclick="testLogin()">Test Login</button>
                                    <span id="login-status" class="ms-2">‚è≥</span>
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-info btn-sm" onclick="testRegister()">Test Register</button>
                                    <span id="register-status" class="ms-2">‚è≥</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5>üí∞ Trading Tests</h5>
                            <div id="trading-tests">
                                <div class="mb-3">
                                    <button class="btn btn-warning btn-sm" onclick="testPrices()">Get Prices</button>
                                    <span id="prices-status" class="ms-2">‚è≥</span>
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-secondary btn-sm" onclick="testPortfolio()">Get Portfolio</button>
                                    <span id="portfolio-status" class="ms-2">‚è≥</span>
                                </div>
                                <div class="mb-3">
                                    <button class="btn btn-dark btn-sm" onclick="testAchievements()">Get Achievements</button>
                                    <span id="achievements-status" class="ms-2">‚è≥</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-12">
                            <h5>üìä Test Results</h5>
                            <div id="test-results" class="bg-light p-3 rounded">
                                <p class="text-muted">Click the buttons above to run tests...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="index-1.html" class="btn btn-primary">üöÄ Go to Dashboard</a>
                        <a href="page-login.html" class="btn btn-outline-primary ms-2">üîê Login Page</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/api.js"></script>
    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        const api = new MotionFalconAPI();

        function updateStatus(elementId, status, message = '') {
            const element = document.getElementById(elementId);
            const statusMap = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'pending': '‚è≥'
            };
            element.innerHTML = statusMap[status] + (message ? ` ${message}` : '');
            element.className = `ms-2 status-${status}`;
        }

        function addResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultHtml = `
                <div class="alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show">
                    <strong>${title}</strong><br>
                    <pre class="mb-0 mt-2" style="font-size: 0.8rem;">${JSON.stringify(content, null, 2)}</pre>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
        }

        async function testHealthCheck() {
            updateStatus('health-status', 'pending');
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus('health-status', 'success', 'Connected');
                    addResult('Health Check', data, 'success');
                } else {
                    updateStatus('health-status', 'error', 'Failed');
                    addResult('Health Check', data, 'error');
                }
            } catch (error) {
                updateStatus('health-status', 'error', 'Error');
                addResult('Health Check', { error: error.message }, 'error');
            }
        }

        async function testLogin() {
            updateStatus('login-status', 'pending');
            try {
                const response = await api.simpleLogin('test@example.com', 'password123');
                updateStatus('login-status', 'success', 'Success');
                addResult('Login Test', response, 'success');
            } catch (error) {
                updateStatus('login-status', 'error', 'Failed');
                addResult('Login Test', { error: error.message }, 'error');
            }
        }

        async function testRegister() {
            updateStatus('register-status', 'pending');
            try {
                const response = await api.register('testuser', 'test@example.com', 'password123');
                updateStatus('register-status', 'success', 'Success');
                addResult('Register Test', response, 'success');
            } catch (error) {
                updateStatus('register-status', 'error', 'Failed');
                addResult('Register Test', { error: error.message }, 'error');
            }
        }

        async function testPrices() {
            updateStatus('prices-status', 'pending');
            try {
                const response = await api.getPrices();
                updateStatus('prices-status', 'success', `${response.data.prices?.length || 0} prices`);
                addResult('Prices Test', response, 'success');
            } catch (error) {
                updateStatus('prices-status', 'error', 'Failed');
                addResult('Prices Test', { error: error.message }, 'error');
            }
        }

        async function testPortfolio() {
            updateStatus('portfolio-status', 'pending');
            try {
                // First login to get token
                await api.simpleLogin('test@example.com', 'password123');
                
                const response = await api.getPortfolio();
                updateStatus('portfolio-status', 'success', 'Success');
                addResult('Portfolio Test', response, 'success');
            } catch (error) {
                updateStatus('portfolio-status', 'error', 'Failed');
                addResult('Portfolio Test', { error: error.message }, 'error');
            }
        }

        async function testAchievements() {
            updateStatus('achievements-status', 'pending');
            try {
                // First login to get token
                await api.simpleLogin('test@example.com', 'password123');
                
                const response = await api.getUserAchievements();
                updateStatus('achievements-status', 'success', `${response.data?.length || 0} achievements`);
                addResult('Achievements Test', response, 'success');
            } catch (error) {
                updateStatus('achievements-status', 'error', 'Failed');
                addResult('Achievements Test', { error: error.message }, 'error');
            }
        }

        // Auto-run health check on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testHealthCheck, 1000);
        });
    </script>
</body>
</html> 